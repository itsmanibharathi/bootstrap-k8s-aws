---
- name: Create ClusterRoleBinding for bootstrap CSR creation
  shell: |
    kubectl create clusterrolebinding create-csrs-for-bootstrapping \
      --clusterrole=system:node-bootstrapper \
      --group=system:bootstrappers \
      --dry-run=client -o yaml | kubectl apply -f -

- name: Create ClusterRoleBinding for auto-approving bootstrap CSRs
  shell: |
    kubectl create clusterrolebinding auto-approve-csrs-for-group \
      --clusterrole=system:certificates.k8s.io:certificatesigningrequests:nodeclient \
      --group=system:bootstrappers \
      --dry-run=client -o yaml | kubectl apply -f -

- name: Create ClusterRoleBinding for auto-renewing node certificates
  shell: |
    kubectl create clusterrolebinding auto-approve-renewals-for-nodes \
      --clusterrole=system:certificates.k8s.io:certificatesigningrequests:selfnodeclient \
      --group=system:nodes \
      --dry-run=client -o yaml | kubectl apply -f -